- id: 9bc10f37-0853-4d73-b547-019c11eda22f
  name: Modified Sensitive Directory
  description: Checks sensitive directory hashes against previously stored hashes
    to determine if the directory has been modified
  tactic: detection
  technique:
    attack_id: x
    name: x
  repeatable: true
  platforms:
    linux:
      sh:
        command: "directory=\"#{directory.sensitive.path}\";\nif [ -d $directory ];\n\
          \  then tar -czf /tmp/dir_sens_comp -C $directory .;\n  hash=$(sha256sum\
          \ /tmp/dir_sens_comp | cut -d' ' -f1);\n  rm -f /tmp/dir_sens_comp;\n  if\
          \ [ \"$hash\" != \"#{directory.sensitive.hash}\" ];\n    then echo $directory;\n\
          \  fi;\nelse echo $directory;\nfi;\n"
        parsers:
          plugins.stockpile.app.parsers.basic:
          - source: directory.sensitive.path
            edge: has_property
            target: has_been_modified
    darwin:
      sh:
        command: "directory=\"#{directory.sensitive.path}\";\nif [ -d $directory ];\n\
          \  then tar -cf - -C $directory . | gzip --no-name > /tmp/dir_sens_comp;\n\
          \  hash=$(shasum -a 256 /tmp/dir_sens_comp | cut -d' ' -f1);\n  rm -f /tmp/dir_sens_comp;\n\
          \  if [ \"$hash\" != \"#{directory.sensitive.hash}\" ];\n    then echo $directory;\n\
          \  fi;\nelse echo $directory;\nfi;\n"
        parsers:
          plugins.stockpile.app.parsers.basic:
          - source: directory.sensitive.path
            edge: has_property
            target: has_been_modified
    windows:
      psh:
        command: "$directory = \"#{directory.sensitive.path}\";\nif (Test-Path -PathType\
          \ Container $directory) {\n  Compress-Archive -Force -Path $($directory\
          \ + \"\\*\") -DestinationPath C:\\Users\\Public\\dir_sens_comp.zip;\n  $hash\
          \ = (Get-FileHash C:\\Users\\Public\\dir_sens_comp.zip).Hash;\n  Remove-Item\
          \ -Force C:\\Users\\Public\\dir_sens_comp.zip;\n  if ($hash -ne \"#{directory.sensitive.hash}\"\
          ) {\n    echo $directory;\n  }\n} else {\n  echo $directory;\n}\n"
        parsers:
          plugins.stockpile.app.parsers.basic:
          - source: directory.sensitive.path
            edge: has_property
            target: has_been_modified
  requirements:
  - plugins.stockpile.app.requirements.basic:
    - source: directory.sensitive.path
      edge: has_hash
      target: directory.sensitive.hash
  - plugins.stockpile.app.requirements.paw_provenance:
    - source: directory.sensitive.hash
