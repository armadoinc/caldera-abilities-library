- id: ee54384f-cfbc-4228-9dc1-cc5632307afb
  name: New Cron Jobs
  description: Checks to see if a new (unauthorized) cron job has been added
  tactic: detection
  technique:
    attack_id: x
    name: x
  repeatable: true
  platforms:
    linux:
      sh:
        command: "set -f;\nfor user in $(getent passwd | cut -f1 -d:); do\n  $(crontab\
          \ -u $user -l 2>/dev/null | grep -v '\\#' | while read -r job; do\n    echo\
          \ \"${user}>${job}\" >> /tmp/cron_jobs;\n  done);\ndone;\ncat /tmp/cron_jobs\
          \ | sort > /tmp/new_cronjobs_list.txt;\nnew_jobs=$(comm -13 /tmp/baseline_cronjobs_list.txt\
          \ /tmp/new_cronjobs_list.txt);\nrm -f /tmp/cron_jobs;\nrm -f /tmp/new_cronjobs_list.txt;\n\
          IFS=$(echo '\\n');\necho $new_jobs;\n"
        parsers:
          plugins.response.app.parsers.key_value:
          - source: host.user.name
            edge: has_new_cronjob
            target: host.new.cronjob
    darwin:
      sh:
        command: "set -f;\nfor user in $(dscl . list /Users | grep -v \"^_\"); do\n\
          \  $(crontab -u $user -l 2>/dev/null | grep -v '\\#' | while read -r job;\
          \ do\n    echo \"${user}>${job}\" >> /tmp/cron_jobs;\n  done);\ndone;\n\
          cat /tmp/cron_jobs | sort > /tmp/new_cronjobs_list.txt;\nnew_jobs=$(comm\
          \ -13 /tmp/baseline_cronjobs_list.txt /tmp/new_cronjobs_list.txt);\nrm -f\
          \ /tmp/cron_jobs;\nrm -f /tmp/new_cronjobs_list.txt;\nIFS=$(echo '\\n');\n\
          echo $new_jobs;\n"
        parsers:
          plugins.response.app.parsers.key_value:
          - source: host.user.name
            edge: has_new_cronjob
            target: host.new.cronjob
