- id: 622e4bda-e5a8-42bb-93d9-a7b1eebc7e41
  name: Backup Bash Profiles
  description: If bash profile doesn't exist, create it, and then backup each profile.
  tactic: setup
  technique:
    attack_id: x
    name: x
  repeatable: false
  platforms:
    linux:
      sh:
        command: "mkdir -p /tmp/sensitive_file_backups;\nuser_profiles=\".bashrc .bash_profile\
          \ .bash_login .profile\";\noutput=\"\";\nhome_dir=$(echo \"/home/*\" | sed\
          \ 's/\\\\\\*/\\*/g');\ndirs=$(find $home_dir -maxdepth 0 -type d);\ndirs=\"\
          ${dirs} /root\";\nfiles=\"\";\nfor dir in $dirs;\n  do for prof in $user_profiles;\n\
          \    do files=\"${files}${dir}/${prof} \";\n  done;\ndone;\nfiles=\"${files}\
          \ /etc/profile /etc/bash.bashrc\";\nfor file in $files;\n  do if [ ! -f\
          \ $file ];\n    then touch $file;\n  fi;\n  randname=$(head /dev/urandom\
          \ | tr -dc A-Za-z0-9 | head -c 13);\n  cp $file /tmp/sensitive_file_backups/$randname;\n\
          \  output=\"${output}${file}>${randname}\\n\";\ndone;\necho $output | sed\
          \ '/^[[:space:]]*$/d'\n"
        parsers:
          plugins.response.app.parsers.key_value:
          - source: file.sensitive.path
            edge: has_backup
            target: file.backup.name
        cleanup: "user_profiles=\".bashrc .bash_profile .bash_login .profile\";\n\
          output=\"\";\nhome_dir=$(echo \"/home/*\" | sed 's/\\\\\\*/\\*/g');\ndirs=$(find\
          \ $home_dir -maxdepth 0 -type d);\ndirs=\"${dirs} /root\";\nfiles=\"\";\n\
          for dir in $dirs;\n  do for prof in $user_profiles;\n    do files=\"${files}${dir}/${prof}\
          \ \";\n  done;\ndone;\nfiles=\"${files} /etc/profile /etc/bash.bashrc\"\
          ;\nfor file in $files;\n  do if [ ! -s $file ];\n    then rm -f $file;\n\
          \  fi;\ndone;\nrm -rf /tmp/sensitive_file_backups;\n"
    darwin:
      sh:
        command: "mkdir -p /tmp/sensitive_file_backups;\nuser_profiles=\".bashrc .bash_profile\
          \ .bash_login .profile\";\noutput=\"\";\nhome_dir=$(echo \"/Users/*\" |\
          \ sed 's/\\\\\\*/\\*/g');\ndirs=$(find $home_dir -maxdepth 0 -type d);\n\
          dirs=\"${dirs} /var/root\";\nfiles=\"\";\nfor dir in $dirs;\n  do for prof\
          \ in $user_profiles;\n    do files=\"${files}${dir}/${prof} \";\n  done;\n\
          done;\nfiles=\"${files} /etc/profile /etc/bash.bashrc\";\nfor file in $files;\n\
          \  do if [ ! -f $file ];\n    then touch $file;\n  fi;\n  randname=$(head\
          \ /dev/urandom | LC_CTYPE=C tr -dc A-Za-z0-9 | head -c 13);\n  cp $file\
          \ /tmp/sensitive_file_backups/$randname;\n  output=\"${output}${file}>${randname}\\\
          n\";\ndone;\necho $output | sed '/^[[:space:]]*$/d'\n"
        parsers:
          plugins.response.app.parsers.key_value:
          - source: file.sensitive.path
            edge: has_backup
            target: file.backup.name
        cleanup: "user_profiles=\".bashrc .bash_profile .bash_login .profile\";\n\
          output=\"\";\nhome_dir=$(echo \"/Users/*\" | sed 's/\\\\\\*/\\*/g');\ndirs=$(find\
          \ $home_dir -maxdepth 0 -type d);\ndirs=\"${dirs} /var/root\";\nfiles=\"\
          \";\nfor dir in $dirs;\n  do for prof in $user_profiles;\n    do files=\"\
          ${files}${dir}/${prof} \";\n  done;\ndone;\nfiles=\"${files} /etc/profile\
          \ /etc/bash.bashrc\";\nfor file in $files;\n  do if [ ! -s $file ];\n  \
          \  then rm -f $file;\n  fi;\ndone;\nrm -rf /tmp/sensitive_file_backups;"
