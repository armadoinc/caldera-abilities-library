- id: 32e563bb-ba06-4bcc-b817-fc2c434c0b66
  name: Remove Unauthorized Cron Job
  description: Removes newly added cron jobs
  tactic: response
  technique:
    attack_id: x
    name: x
  platforms:
    linux:
      sh:
        command: "crontab -u #{host.user.name} -l > temp_crontab;\nline_number=$(grep\
          \ -n '#{host.new.cronjob}' temp_crontab | cut -d':' -f1);\nif [ $line_number\
          \ ]; then\n  sed \"${line_number}d\" temp_crontab > new_crontab;\n  crontab\
          \ -u #{host.user.name} new_crontab;\n  rm -f new_crontab;\nfi;\nrm -f temp_crontab\
          \ new_crontab;\n"
    darwin:
      sh:
        command: "crontab -u #{host.user.name} -l > temp_crontab;\nline_number=$(grep\
          \ -n '#{host.new.cronjob}' temp_crontab | cut -d':' -f1);\nif [ $line_number\
          \ ]; then\n  sed \"${line_number}d\" temp_crontab > new_crontab;\n  crontab\
          \ -u #{host.user.name} new_crontab;\n  rm -f new_crontab;\nfi;\nrm -f temp_crontab\
          \ new_crontab;\n"
  requirements:
  - plugins.stockpile.app.requirements.basic:
    - source: host.user.name
      edge: has_new_cronjob
      target: host.new.cronjob
  - plugins.stockpile.app.requirements.paw_provenance:
    - source: host.new.cronjob
