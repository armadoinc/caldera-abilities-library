- id: 3796a00b-b11d-4731-b4ca-275a07d83299
  name: Impersonate user
  description: Run an application as a different user
  tactic: execution
  technique:
    attack_id: T1059.001
    name: 'Command and Scripting Interpreter: PowerShell'
  platforms:
    windows:
      psh:
        command: "$job = Start-Job -ScriptBlock {\n  $username = '#{host.user.name}';\n\
          \  $password = '#{host.user.password}';\n  $securePassword = ConvertTo-SecureString\
          \ $password -AsPlainText -Force;\n  $credential = New-Object System.Management.Automation.PSCredential\
          \ $username, $securePassword;\n  Start-Process Notepad.exe -NoNewWindow\
          \ -PassThru -Credential $credential;\n};\nReceive-Job -Job $job -Wait;\n"
  requirements:
  - plugins.stockpile.app.requirements.paw_provenance:
    - source: host.user.name
  - plugins.stockpile.app.requirements.basic:
    - source: host.user.name
      edge: has_password
      target: host.user.password
