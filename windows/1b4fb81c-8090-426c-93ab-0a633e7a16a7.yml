- id: 1b4fb81c-8090-426c-93ab-0a633e7a16a7
  name: Sniff network traffic
  description: Perform a packet capture
  tactic: credential-access
  technique:
    attack_id: T1040
    name: Network Sniffing
  privilege: Elevated
  platforms:
    windows:
      psh:
        timeout: 80
        command: "$path = \"$ENV:UserProfile\\Desktop\\pcap.etl\";\nNew-NetEventSession\
          \ -Name \"PCAP\" -CaptureMode SaveToFile -LocalFilePath $path;\nAdd-NetEventProvider\
          \ -Name \"Microsoft-Windows-TCPIP\" -SessionName \"PCAP\";\nStart-NetEventSession\
          \ -Name \"PCAP\";\nStart-Sleep -s 60;\nStop-NetEventSession -Name \"PCAP\"\
          ;\nif (Test-Path $path) {\n  echo $path;\n  exit 0;\n} else {\n  echo \"\
          Failed to generate PCAP file.\";\n  exit 1;\n};\n"
        cleanup: 'Remove-NetEventSession -Name "PCAP";

          Remove-Item $ENV:UserProfile\Desktop\pcap.etl;

          '
    darwin:
      sh:
        command: 'tcpdump -i en0 & sleep 5; kill $!

          '
